---
import { readdirSync, existsSync } from 'fs';
import { join, basename } from 'path';
import Head from '../components/Head.astro';
import Preloader from '../components/Preloader.astro';
import '../styles/global.css';
import manifest from '../generated/manifest.json';

const publicDir = join(process.cwd(), 'public');

const musicDir = join(publicDir, 'music')
const tracks: { file: string; name: string }[] = []
if (existsSync(musicDir)) {
  for (const f of readdirSync(musicDir).filter(f => f.toLowerCase().endsWith('.mp3')).sort()) {
    tracks.push({ file: f, name: basename(f, '.mp3') })
  }
}
---

<!DOCTYPE html>
<html lang="en">
<head>
  <Head />
</head>
<body>
  <div id="app">
    <Preloader manifest={manifest} tracks={tracks} />
  </div>

  <script>
    import 'bashtorio-core/style.css';
    import '../scripts/game';
  </script>
</body>
</html>
